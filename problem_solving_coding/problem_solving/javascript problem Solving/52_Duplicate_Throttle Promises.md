## Throttle Promises

### Explanation:

- Say you need to fetch some data through 100 APIs, and as soon as possible.
- If you use Promise.all(), 100 requests go to your server at the same time, which is a burden to low spec servers.
- Can you throttle your API calls so that always maximum 5 API calls at the same time?
- You are asked to create a general throttlePromises() which takes an array of functions returning promises, and a number indicating the maximum concurrent pending promises.

**Approach Taken**

```js
function throttleAsync(tasks, maxConcurrent) {
  let results = [];
  let index = 0;

  function executeBatch() {
    // Get the next batch of tasks (set of 5)
    const currentTasks = getNextBatch();
    //If there are no tasks left (ex: all the Promises are settled with values and everything, there is nothing to be executed)
    if (currentTasks.length === 0) {
      // stops from executing the code, as a stopper
      return Promise.resolve();
    }

    // Execute current batch and handle results
    return (
      Promise.allSettled(currentTasks)
        // then processes the results,
        .then(processResults)
        // and calls itself recursively to execute the next batch.
        .then(executeBatch)
    );
  }

  function getNextBatch() {
    //Slices the tasks array (effectively picking out the batch based on the index, index+maxConcurrent)
    const batch = tasks
      .slice(index, index + maxConcurrent)
      .map((task) => task());

    // Increments index by maxConcurrent to prepare for the next batch.
    index += maxConcurrent;
    // Returns an array of promises generated by invoking each task in the batch.
    return batch;
  }

  // processResults function does Iterates over the results of the batch execution.
  function processResults(values) {
    for (const value of values) {
      if (value.status === 'fulfilled') {
        results.push(value.value);
      } else {
        throw value.reason;
      }
    }
  }

  // Initiates the batch execution process by calling executeBatch and returns a promise that resolves with the results array once all tasks are completed.
  return executeBatch().then(() => results);
}

// Function to generate a URL for a given ID (ex: id is 1 to 20)
function generateUrl(id) {
  return `https://jsonplaceholder.typicode.com/posts/${id}`;
}

// Updated task creation function for real-time API calls
function createApiTask(url) {
  return () =>
    fetch(url)
      .then((response) => response.json())
      .then((data) => {
        console.log(`API call to ${url} finished`);
        return data;
      });
}

// Generate URLs for IDs from 1 to 100
const urls = Array.from({ length: 20 }, (_, i) => generateUrl(i + 1));

// apiTasks: An array of tasks created for each URL.
let apiTasks = urls.map((url) => createApiTask(url));

// throttleAsync is called with apiTasks and a concurrency limit of 5.
throttleAsync(apiTasks, 5)
  .then((data) => {
    console.log('All data:', data);
  })
  .catch((err) => {
    console.error(err);
  });
```

![image](https://github.com/saiteja-gatadi1996/interview_prep/assets/42731246/8ebce8d0-5e87-4af8-8bff-aab875e6a828)
